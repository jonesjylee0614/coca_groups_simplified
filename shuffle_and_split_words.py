#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å°† all_words.txt ä¸­çš„å•è¯å®Œå…¨æ‰“ä¹±é¡ºåºï¼Œ
ç„¶åæŒ‰æ¯ç»„25ä¸ªå•è¯åˆ†æˆ200ä¸ªæ–‡ä»¶ï¼ˆg1-g200ï¼‰
ä¿å­˜åˆ°æ–°çš„ seed_shuffled ç›®å½•ä¸­
"""

import sys
import random
from pathlib import Path
from typing import List

# è®¾ç½®æ§åˆ¶å°è¾“å‡ºç¼–ç ä¸º UTF-8ï¼ˆè§£å†³ Windows æ§åˆ¶å°ç¼–ç é—®é¢˜ï¼‰
if sys.platform == 'win32':
    try:
        sys.stdout.reconfigure(encoding='utf-8')
    except Exception:
        pass


# ä½¿ç”¨æŒ‡ä»¤æ¨¡æ¿ï¼ˆæå–ä¸ºå¸¸é‡ä»¥é¿å…é‡å¤ï¼‰
USAGE_GUIDE = """## ğŸ§­ ä½¿ç”¨æŒ‡ä»¤ï¼ˆä¸“ä¸šç‰ˆï¼‰

> ä½ æ˜¯ä¸€ä½ **è‹±è¯­æ•™è‚²å†™ä½œä¸“å®¶**ï¼Œè¯·ä»¥"è¯­è¨€è‡ªç„¶ + æ•™è‚²å¯¼å‘ + å™äº‹å¸å¼•åŠ›"ä¸ºç›®æ ‡ï¼Œ
> åŸºäºç»™å®šè¯æ±‡åˆ—è¡¨ï¼Œåˆ›ä½œä¸€ç¯‡**é«˜å¯è¯»æ€§æ•…äº‹å‹è¯æ±‡å­¦ä¹ ææ–™**ã€‚

---

## ä¸€ã€æ˜ç¡®ç”Ÿæˆç›®æ ‡

**è¦æ±‚ï¼š**
- æ•…äº‹è¦æœ‰ **å®Œæ•´ä¸‰å¹•ç»“æ„ï¼ˆå¼€ç«¯ã€å†²çªã€ç»“å±€ï¼‰**
- ç›®æ ‡ï¼šè®©å­¦ä¹ è€…åœ¨é˜…è¯»ä¸­"è‡ªç„¶å¸æ”¶è¯æ±‡ + ç†è§£è¯­æ³• + ä½“éªŒæƒ…æ„Ÿ"
- è¾“å‡ºå¿…é¡»é€‚åˆ **CEFR B2â€“C1** å­¦ä¹ è€…ï¼ˆå¥å¼ä¸å®œå¤ªçŸ­ï¼Œä¹Ÿä¸å®œè¿‡äºå­¦æœ¯ï¼‰
- ä¸è¦å †ç Œè¯æ±‡ï¼Œè¦è‡ªç„¶ã€æƒ…å¢ƒåˆç†

---

## äºŒã€å™äº‹ç»“æ„çº¦æŸ

**å¼ºåˆ¶è¦æ±‚åŒ…å«ä»¥ä¸‹é€»è¾‘éª¨æ¶ï¼š**

| é˜¶æ®µ | ä¸»è¦ä»»åŠ¡ | AIæ‰§è¡Œè¯´æ˜ |
|------|----------|------------|
| **å¼€ç«¯ (Setting)** | äº¤ä»£äººç‰©ã€èƒŒæ™¯ã€å†²çªå‰æ | è®¾å®šåœºæ™¯ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€è§’è‰²ï¼‰ï¼Œ2â€“3å¥å¼•å‡ºæ•…äº‹åŸºè°ƒ |
| **å‘å±• (Conflict)** | å‡ºç°é—®é¢˜æˆ–æŒ‘æˆ˜ï¼Œå¼•å‘æƒ…æ„Ÿå¼ åŠ› | ç”¨å¯¹è¯ã€è¡ŒåŠ¨ã€æ€è€ƒæ¥å±•ç¤ºçŸ›ç›¾ï¼ˆä¸æ˜¯æ‘˜è¦å¼å™è¿°ï¼‰ |
| **é«˜æ½®ä¸è½¬æŠ˜ (Climax)** | äººç‰©å†³ç­–æˆ–å±æœºæ—¶åˆ» | ä¸€æ®µå…³é”®äº‹ä»¶ï¼ˆå¦‚å¤±è¯¯ã€æ•‘æ´ã€å†²çªï¼‰ï¼Œå¥å¼å¯ç•¥é•¿ |
| **ç»“å°¾ (Resolution)** | é—®é¢˜è§£å†³ä¸ä¸»é¢˜å‡å | æ€»ç»“äººç‰©æˆé•¿æˆ–é“å¾·å¯ç¤ºï¼Œå¥å¼ä¼˜ç¾ã€æœ‰æ€è€ƒæ„Ÿ |

---

## ä¸‰ã€æƒ…æ„Ÿä¸é£æ ¼æŒ‡ä»¤

- äººç‰©éœ€æœ‰å†…å¿ƒæ´»åŠ¨æˆ–å¿ƒç†å˜åŒ–
- ä½¿ç”¨æƒ…æ„ŸåŠ¨è¯ã€æ¯”å–»å’Œæ„Ÿå®˜æå†™ï¼ˆsee, feel, hear, smell, tasteï¼‰
- æ¯ä¸€æ®µè½éƒ½æœ‰ä¸€ä¸ª"æƒ…ç»ªè‰²å½©å…³é”®è¯"ï¼ˆå¦‚ tense, warm, relievedï¼‰
- é¿å…ä½¿ç”¨é™ˆè¯æ»¥è°ƒï¼ˆclichÃ©ï¼‰
- å¯¹è¯ä¸è¶…è¿‡å…¨æ–‡çš„ 15%ï¼Œä½†å¿…é¡»è‡³å°‘å‡ºç°ä¸€æ¬¡ï¼ˆæå‡çœŸå®æ„Ÿï¼‰

---

## å››ã€è¯­è¨€ä¸é£æ ¼è´¨é‡æ§åˆ¶

- æ¯æ®µå¥å‹åº”æ··åˆä½¿ç”¨ï¼š**ç®€å•å¥ + å¹¶åˆ—å¥ + ä»å¥**
- ç›®æ ‡è¯æ±‡**åŠ ç²— + éŸ³æ ‡ + ä¸­æ–‡é‡Šä¹‰**æ ¼å¼ï¼š`**word** /éŸ³æ ‡/ (è¯æ€§. ä¸­æ–‡)`
- æ¯å¥ä¸è¶…è¿‡ 25 è¯ï¼Œé¿å…é•¿éš¾å¥
- é™åˆ¶é«˜é¢‘å•è¯é‡å¤ç‡ï¼ˆå¦‚ "she felt..." ä¸è¶…è¿‡3æ¬¡ï¼‰
- é€‚åº¦ä½¿ç”¨ä¿®è¾ï¼ˆæ˜å–»ã€å¯¹æ¯”ã€æ‹Ÿäººï¼‰
- ä¸Šæ–¹æ‰€æœ‰å•è¯ï¼ˆå½“å‰ Group åˆ—è¡¨ï¼‰**éƒ½è¦åœ¨æ–‡ä¸­è‡³å°‘å‡ºç°ä¸€æ¬¡**

---

## äº”ã€è¾“å‡ºç»“æ„æ ¼å¼

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ **å…­ä¸ªéƒ¨åˆ†** è¾“å‡ºç»“æœï¼š

### **Part 1. Storyï¼ˆè‹±æ–‡åŸæ–‡ï¼‰**
ä»¥è‡ªç„¶æ®µå½¢å¼å†™å‡ºæ•…äº‹æ­£æ–‡ï¼Œå¹¶åœ¨æ–‡ä¸­æ ‡æ³¨è¯æ±‡ã€éŸ³æ ‡å’Œä¸­æ–‡é‡Šä¹‰ã€‚

### **Part 2. æ•…äº‹ç¿»è¯‘ï¼ˆä¸­æ–‡ï¼‰**
é€æ®µç¿»è¯‘æ•…äº‹å†…å®¹ï¼Œä¿æŒè¯­æ°”æµç•…è‡ªç„¶ã€‚

### **Part 3. è¯æ±‡è¯¦è§£è¡¨**
ä»¥è¡¨æ ¼å½¢å¼åˆ—å‡ºæ‰€æœ‰ç›®æ ‡å•è¯çš„è¯¦ç»†ä¿¡æ¯ï¼š

| å•è¯ | éŸ³æ ‡ | è¯æ€§ | ä¸­æ–‡é‡Šä¹‰ | ç®€çŸ­ä¾‹å¥ï¼ˆåŸåˆ›ï¼‰ |
|------|------|------|------------|------------------|

### **Part 4. é‡ç‚¹å¥è®²è§£**
é€‰æ‹©æ•…äº‹ä¸­ 3â€“5 ä¸ªå…¸å‹å¥å­ï¼Œåˆ†æå…¶å¥æ³•ç»“æ„ã€è¯­æ³•è¦ç‚¹æˆ–è¡¨è¾¾äº®ç‚¹ï¼Œå¹¶è§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·ç”¨ã€‚

### **Part 5. è¯­æ³•èšç„¦ï¼ˆGrammar Focusï¼‰**
æŒ‘å‡º 1â€“2 ä¸ªå¥å­åˆ†æç‰¹å®šè¯­æ³•ç‚¹ï¼ˆå¦‚è¿‡å»å®Œæˆæ—¶ã€è¢«åŠ¨è¯­æ€ã€æ¡ä»¶å¥ç­‰ï¼‰ï¼Œè§£é‡Šç”¨æ³•ä¸æ›¿æ¢å¥ã€‚

**ç¤ºä¾‹æ ¼å¼ï¼š**
- **åŸå¥ï¼š** She had been born and raised in conventional surroundings.
- **èšç„¦ï¼š** è¿‡å»å®Œæˆæ—¶è¢«åŠ¨ï¼ˆhad been + p.p.ï¼‰
- **ç”¨æ³•ï¼š** æè¿°åœ¨æ•…äº‹å¼€å§‹å‰å·²ç»å®Œæˆçš„èƒŒæ™¯äº‹ä»¶
- **å¯æ›¿æ¢å¥ï¼š** She grew up in a traditional family.

### **Part 6. å»¶ä¼¸ç»ƒä¹ ï¼ˆPractice & Reflectionï¼‰**

#### **6.1 ç†è§£é¢˜ï¼ˆComprehensionï¼‰**
3â€“5 é“ç†è§£é¢˜ï¼ˆWho / Why / What if ç±»å‹ï¼‰

#### **6.2 è¯æ±‡ç»ƒä¹ ï¼ˆVocabulary Practiceï¼‰**
å¡«ç©ºæˆ–é€ å¥ç»ƒä¹ ï¼ˆ3â€“5é¢˜ï¼‰

#### **6.3 å†™ä½œä»»åŠ¡ï¼ˆWriting Promptï¼‰**
å†™ä¸€æ®µ 100 è¯ä»¥å†…çš„å°çŸ­æ–‡ï¼Œå›´ç»•æ•…äº‹ä¸»é¢˜

#### **6.4 è®¨è®ºé—®é¢˜ï¼ˆDiscussionï¼‰**
ç»™å‡ºä¸€ä¸ªå¼€æ”¾é—®é¢˜ï¼Œä¾‹å¦‚ï¼š
> "Do you think compassion can really change the world?"

---

## å…­ã€é£æ ¼æ ‡ç­¾ï¼ˆå¯é€‰æ‹©ä¸€ä¸ªï¼‰

é€‰æ‹©ä¸€ä¸ªé€‚åˆè¯æ±‡çš„é£æ ¼æ ‡ç­¾ï¼š

| æ ‡ç­¾ | é£æ ¼æè¿° | åœºæ™¯ä¾‹å­ |
|------|----------|----------|
| `#Adventure` | èŠ‚å¥å¿«ï¼Œä»»åŠ¡å‹å™äº‹ | æ¢é™©ã€æ•‘æ´ã€æ—…ç¨‹ |
| `#SliceOfLife` | å¹³å‡¡äººå°æ•…äº‹ï¼Œç»†è…»æƒ…æ„Ÿ | æ•™å¸ˆã€æœ‹å‹ã€å®¶åº­ |
| `#MoralReflection` | æœ‰å“²ç†ä¸å¯å‘æ€§ | ä»·å€¼è§‚ã€æˆé•¿ |
| `#LightHumor` | æ¸©å’Œå¹½é»˜ï¼Œè½»æ¾æ°›å›´ | å°é•‡ã€æ ¡å›­è¶£äº‹ |
| `#TechAndFuture` | ç§‘æŠ€é¢˜æï¼Œæ€è¾¨è‰²å½© | AIã€åˆ›æ–°ã€ç¤¾ä¼šå˜è¿ |

---

## ä¸ƒã€è´¨é‡æ£€æŸ¥æ¸…å•

è¾“å‡ºå‰è¯·è‡ªæ£€ï¼š
- âœ… æ•…äº‹æœ‰å®Œæ•´çš„å¼€ç«¯ã€å‘å±•ã€é«˜æ½®ã€ç»“å°¾
- âœ… æ‰€æœ‰ç›®æ ‡å•è¯éƒ½è‡ªç„¶èå…¥æ•…äº‹
- âœ… æœ‰å¯¹è¯å’Œå†…å¿ƒæå†™
- âœ… å¥å¼å¤šæ ·ï¼Œé¿å…é‡å¤
- âœ… æ ‡æ³¨æ ¼å¼ç»Ÿä¸€
- âœ… å…­ä¸ªéƒ¨åˆ†éƒ½å®Œæ•´è¾“å‡º
- âœ… è¾“å‡ºæ ¼å¼ä½¿ç”¨ Markdown
"""


def load_words(file_path: Path) -> List[str]:
    """
    ä»æ–‡ä»¶ä¸­åŠ è½½å•è¯åˆ—è¡¨
    
    Args:
        file_path: å•è¯æ–‡ä»¶è·¯å¾„
        
    Returns:
        å•è¯åˆ—è¡¨
    """
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            return [line.strip() for line in f if line.strip()]
    except FileNotFoundError:
        print(f"âŒ é”™è¯¯: æ–‡ä»¶ {file_path} ä¸å­˜åœ¨")
        return []
    except Exception as e:
        print(f"âŒ è¯»å–æ–‡ä»¶å¤±è´¥: {e}")
        return []


def create_group_file(output_dir: Path, group_num: int, words: List[str]) -> bool:
    """
    åˆ›å»ºå•ä¸ªåˆ†ç»„æ–‡ä»¶
    
    Args:
        output_dir: è¾“å‡ºç›®å½•
        group_num: ç»„å·
        words: å•è¯åˆ—è¡¨
        
    Returns:
        æ˜¯å¦æˆåŠŸ
    """
    try:
        output_file = output_dir / f'g{group_num}.md'
        
        # æ„å»ºæ–‡ä»¶å†…å®¹
        formatted_words = ', '.join(f'**{word}**' for word in words)
        content = f"""# Group {group_num}

## Word List
{formatted_words}

{USAGE_GUIDE}"""
        
        # å†™å…¥æ–‡ä»¶
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write(content)
        
        return True
    except Exception as e:
        print(f"âŒ åˆ›å»ºæ–‡ä»¶ g{group_num}.md å¤±è´¥: {e}")
        return False


def main():
    """ä¸»å‡½æ•°"""
    # é…ç½®å‚æ•°
    input_file = Path('all_words.txt')
    output_dir = Path('seed_shuffled')
    words_per_group = 25
    
    print(f"{'='*50}")
    print(f"ğŸ² å•è¯æ‰“ä¹±ä¸åˆ†ç»„å·¥å…·")
    print(f"{'='*50}")
    
    # æ£€æŸ¥å¹¶åŠ è½½å•è¯
    if not input_file.exists():
        print(f"âŒ é”™è¯¯: {input_file} æ–‡ä»¶ä¸å­˜åœ¨")
        print(f"ğŸ’¡ æç¤º: è¯·å…ˆè¿è¡Œ extract_all_words.py ç”Ÿæˆå•è¯æ–‡ä»¶")
        return 1
    
    words = load_words(input_file)
    if not words:
        return 1
    
    print(f"ğŸ“– è¯»å–äº† {len(words)} ä¸ªå•è¯")
    
    # å®Œå…¨æ‰“ä¹±é¡ºåºï¼ˆè®¾ç½®éšæœºç§å­ä»¥ä¾¿éœ€è¦æ—¶å¯ä»¥å¤ç°ï¼‰
    random.shuffle(words)
    print(f"ğŸ² å•è¯é¡ºåºå·²å®Œå…¨æ‰“ä¹±")
    
    # åˆ›å»ºè¾“å‡ºç›®å½•
    try:
        output_dir.mkdir(exist_ok=True)
        print(f"ğŸ“ è¾“å‡ºç›®å½•: {output_dir}")
    except Exception as e:
        print(f"âŒ åˆ›å»ºç›®å½•å¤±è´¥: {e}")
        return 1
    
    # è®¡ç®—éœ€è¦åˆ›å»ºçš„ç»„æ•°
    total_groups = (len(words) + words_per_group - 1) // words_per_group
    print(f"ğŸ“ å°†åˆ›å»º {total_groups} ä¸ªæ–‡ä»¶ (æ¯ç»„ {words_per_group} ä¸ªå•è¯)")
    print(f"{'='*50}")
    
    # åˆ†ç»„å¹¶å†™å…¥æ–‡ä»¶
    success_count = 0
    for i in range(total_groups):
        group_num = i + 1
        start_idx = i * words_per_group
        end_idx = min(start_idx + words_per_group, len(words))
        group_words = words[start_idx:end_idx]
        
        if create_group_file(output_dir, group_num, group_words):
            success_count += 1
        
        # æ˜¾ç¤ºè¿›åº¦
        if (group_num % 50 == 0) or (group_num == total_groups):
            print(f"â³ è¿›åº¦: {group_num}/{total_groups} ({group_num*100//total_groups}%)")
    
    # æ˜¾ç¤ºç»“æœ
    print(f"{'='*50}")
    if success_count == total_groups:
        print(f"âœ… å®Œæˆï¼æˆåŠŸåˆ›å»º {success_count} ä¸ªæ–‡ä»¶")
    else:
        print(f"âš ï¸  éƒ¨åˆ†å®Œæˆï¼šæˆåŠŸ {success_count}/{total_groups} ä¸ªæ–‡ä»¶")
    
    print(f"ğŸ“‚ ä¿å­˜ä½ç½®: {output_dir.absolute()}")
    print(f"ğŸ“„ æ–‡ä»¶èŒƒå›´: g1.md - g{total_groups}.md")
    print(f"ğŸ¯ æ¯ç»„å•è¯æ•°: {words_per_group} (æœ€åä¸€ç»„: {len(words[-(len(words) % words_per_group or words_per_group):])})ä¸ª)")
    
    return 0 if success_count == total_groups else 1


if __name__ == '__main__':
    exit(main())

